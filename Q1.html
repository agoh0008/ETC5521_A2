<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alexandra Goh">

<title>Q1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Q1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Q1_files/libs/quarto-html/quarto.js"></script>
<script src="Q1_files/libs/quarto-html/popper.min.js"></script>
<script src="Q1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Q1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Q1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Q1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Q1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Q1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Q1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Q1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alexandra Goh </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="exercise-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise 1</h2>
<p>Data from a recent study of viewports can be found in the data set <code>viewports.csv</code>. The purpose of the data collection was to <em>you simply do not know how users are going to visit your website or web app. Instead of making design decisions on strict, limited breakpoints, keep in mind the sheer amount of fragmentation there is in viewports.</em> The data was collected primarily from the USA and Europe, on 122,321 devices. Below is a glimpse of the data. It has three columns defining the width and height of the screen, and count is the number of devices with these dimensions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,291
Columns: 3
$ Width  &lt;dbl&gt; 390, 393, 375, 390, 393, 414, 375, 428, 375, 375, 430, 412, 390…
$ Height &lt;dbl&gt; 670, 666, 635, 664, 660, 721, 641, 752, 559, 629, 746, 783, 663…
$ Count  &lt;dbl&gt; 8691, 4800, 4618, 2503, 2318, 2130, 1890, 1692, 1643, 1393, 123…</code></pre>
</div>
</div>
<ol type="a">
<li>How many variables in this data and what type are they?</li>
</ol>
<p><strong>There are 3 variables in the ‘viewports’ dataset and all of them are numeric. To be more specific, width and height are continuous variables whilst count is discrete. This is because width and height of the screen are measurements that can take on any real value within a certain range and can have decimal values. Meanwhile, the number of devices with these dimensions (i.e.&nbsp;count) is discrete as it is counted in whole numbers (i.e.&nbsp;number of devices cannot be a fraction or a decimal) and can only take on specific, distinct values.</strong></p>
<ol start="2" type="a">
<li>Based on the description above, and the variables available in the data, posit two open-ended questions that might be interesting to answer with the data.</li>
</ol>
<p><strong>Two open-ended questions that would be interesting to answer with the data based on the variables and description above are:</strong></p>
<p><strong>1) What is the distribution of screen widths and heights among the observed devices?</strong> <em>This question helps us to better understand the common screen size ranges that users have, which can be useful in making informed web design/development decisions.</em></p>
<p><strong>2) Is there a correlation/relationship between screen dimensions (i.e.&nbsp;width and height) and the count of devices with these dimensions?</strong> <em>This question can help us determine if there are any common screen size patterns/variations among users’ devices. For instance, we would be able to see if certain screen sizes are more prevalent than others and if there’s a relationship between size and usage popularity. This can then provide insights into the optimal breakpoints for designing responsive websites and apps that cater to a wide variety of viewports.</em></p>
<ol start="3" type="a">
<li>Create a bubble scatterplot, where size represents the count, with an <code>x=y</code> guideline underlying the points. Describe what you learn about viewport sizes from this plot.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(v, <span class="fu">aes</span>(<span class="at">x =</span> Width, <span class="at">y =</span> Height, <span class="at">size =</span> Count)) <span class="sc">+</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Count"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(v<span class="sc">$</span>Count), <span class="at">by =</span> <span class="dv">500</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">trans =</span> <span class="st">"log"</span>) <span class="sc">+</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Screen Dimensions (USA- &amp; Europe-based Devices)"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Width"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Height"</span>) <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Q1_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Based on the bubble scatterplot above, there’s a significant portion of data points clustered around the ‘x=y’ guideline, indicating that a substantial number of viewports have nearly equal width and height. We can thus infer that there is a tendency for users to access websites/web apps on devices with screens that are of nearly equal width and height (i.e.&nbsp;square or nearly-square dimensions). Most of them also appear to have screen sizes that are of widths and heights &lt;2000 pixels - many users seem to view websites/web apps on smaller-screen devices such as smartphones or small tablets.</strong></p>
<p><strong>However, there are some data points which deviate away from the ‘x=y’ guideline; these represent non-square viewports. Most of them appear to have higher widths (&gt;2000 pixels) but low heights (below 2500 pixels, excluding certain outliers), indicating the prevalence of devices with a landscape orientation. Based on the sizes (counts) of these data points, this suggests that there is also a good number of people browsing on larger-screen devices such as wide-screen monitors and laptops. Web designers should take this into account when optimizing their designs for these larger displays.</strong></p>
<p><strong>It should be noted there are outliers in the dataset as well. Besides a few viewport sizes having large widths and heights, one particular data point has a negative height. This is most likely an error or anomaly in the data, as a negative height for a viewport is not a valid or meaningful measurement.</strong></p>
<ol start="4" type="a">
<li>Make a transformation of the data to create a new variable, <code>aspect_ratio</code>, based on Width and Height, that will allow you to explain the sizes in one of the conventional terms eg 16:9. (Note: use width:height definition of aspect ratio.)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gcd <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(v), </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">function</span>(i) <span class="fu">gcd</span>(v<span class="sc">$</span>Width[i], v<span class="sc">$</span>Height[i]))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>v<span class="sc">$</span>Width <span class="ot">&lt;-</span> v<span class="sc">$</span>Width <span class="sc">/</span> gcd</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>v<span class="sc">$</span>Height <span class="ot">&lt;-</span> v<span class="sc">$</span>Height <span class="sc">/</span> gcd</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>v<span class="sc">$</span>aspect_ratio <span class="ot">&lt;-</span> <span class="fu">paste</span>(v<span class="sc">$</span>Width, <span class="st">":"</span>, v<span class="sc">$</span>Height, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,291
Columns: 4
$ Width        &lt;dbl&gt; 39, 131, 75, 195, 131, 414, 375, 107, 375, 375, 215, 412,…
$ Height       &lt;dbl&gt; 67, 222, 127, 332, 220, 721, 641, 188, 559, 629, 373, 783…
$ Count        &lt;dbl&gt; 8691, 4800, 4618, 2503, 2318, 2130, 1890, 1692, 1643, 139…
$ aspect_ratio &lt;chr&gt; "39:67", "131:222", "75:127", "195:332", "131:220", "414:…</code></pre>
</div>
</div>
<ol start="5" type="a">
<li>Show the aspect ratio as a density plot, where the x axis labels correspond to particular ratios, “1:3”, “9:16”, “1:1”, “16:9”, “3:1”. (Note: Remember that the data is aggregated already, so that Count needs to the incorporated into computing the density. Setting the axis limits to between 0 and 4 is helpful, too.) Describe the distribution and explain what you learn.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>v<span class="sc">$</span>aspect_ratio_numeric <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(v<span class="sc">$</span>aspect_ratio, <span class="st">":"</span>), </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(x[<span class="dv">1</span>])<span class="sc">/</span><span class="fu">as.numeric</span>(x[<span class="dv">2</span>]))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom labels and breaks for the numeric aspect ratio</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>custom_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1:3"</span>, <span class="st">"9:16"</span>, <span class="st">"1:1"</span>, <span class="st">"16:9"</span>, <span class="st">"3:1"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>custom_breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">9</span><span class="sc">/</span><span class="dv">16</span>, <span class="dv">1</span>, <span class="dv">16</span><span class="sc">/</span><span class="dv">9</span>, <span class="dv">3</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the density plot using the numeric aspect ratio</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(v, <span class="fu">aes</span>(<span class="at">x =</span> aspect_ratio_numeric, <span class="at">weight =</span> Count, <span class="at">fill =</span> <span class="st">'red'</span>)) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> custom_breaks,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> custom_labels,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)  </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Aspect Ratio"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Aspect Ratio Density Plot"</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Q1_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>The density plot shows a right-skewed distribution, meaning that most of the devices have aspect ratios on the lower end while there are relatively fewer devices with higher aspect ratios; the density of devices gradually decreases as we move towards higher aspect ratios. The two distinct peaks also indicate a bimodal distribution. The larger peak centered around ‘9:16’ suggests that a substantial proportion of devices in the dataset have this smaller aspect ratio, whereas the smaller peak situated just after ‘16:9’ indicates another group of devices with a larger aspect ratio (but the number of devices are less prevalent compared to the ‘9:16’ group).</strong></p>
<p><strong>In conclusion, this distribution suggests the existence of two distinct groups of devices/users with different viewport preferences - website or web app designers can thus focus on these insights to optimize their designs and user experiences to better cater to the specific needs and expectations of these two user groups, potentially leading to enhanced user satisfaction and engagement.</strong></p>
<ol start="6" type="a">
<li>What is the most frequent aspect ratio? What (type of) device does this correspond to? (Note: You’ll need to do some web searching.)</li>
</ol>
<p><strong>The most frequent aspect ratio is ‘9:16’. A ‘9:16’ aspect ratio is the most common type for vertical videos, and typically corresponds to the vertical screen orientation of a <a href="https://filmora.wondershare.com/video-editing/phone-aspect-ratio.html">smartphone or mobile device</a>. This aspect ratio is commonly associated with smartphones and mobile devices as it allows for comfortable one-handed use in portrait mode when scrolling through social media feeds, reading, etc. In fact, the ‘9:16’ ratio is especially popular for <a href="https://filmora.wondershare.com/video-editing/phone-aspect-ratio.html">social media platforms with video story capabilities</a> (e.g.&nbsp;Instagram stories).</strong></p>
<p><strong>Relating back to our previous density plot, we can thus infer that there is a large proportion of users using smartphone devices, where the screen’s aspect ratio is closer to ‘9:16’.</strong></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>